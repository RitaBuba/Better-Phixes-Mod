### Christian Democrats Development Journal Entry
# Oh my this is so massive
je_bpm_christian_or_democrat = {
	icon = "gfx/interface/icons/invention_icons/unused/secularism.dds"

	group = je_group_crises

	transferable = yes
	can_revolution_inherit = yes

	#scripted_progress_bar = je_bpm_split_christdem_progress_bar
	scripted_progress_bar = je_bpm_christian_democrat_ideology_progress_bar
	scripted_progress_bar = je_bpm_christian_democrats_economy_progress_bar
	#scripted_progress_bar = je_bpm_christian_democrats_welfare_progress_bar

	status_desc = {
		first_valid = {
			#triggered_desc = {
			#	desc = je_securing_full_independence_from_the_church
			#	trigger = {
			#		has_variable = bpm_christian_democrats_sta_ideology
			#		has_variable = bpm_christian_democrats_rel_ideology
			#		has_variable = bpm_christian_democrats_dop_ideology
			#		has_variable = bpm_christian_democrats_eco_ideology
			#		has_variable = bpm_christian_democrats_wel_ideology
			#		has_variable = bpm_christian_democrats_cit_ideology
			#		has_variable = bpm_christian_democrats_mil_ideology
			#		has_variable = bpm_christian_democrats_fem_ideology
			#		has_variable = bpm_christian_democrats_program_completed
			#	}
			#}
			triggered_desc = {
				desc = je_finalizing_the_political_program
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_dop_ideology
					has_variable = bpm_christian_democrats_eco_ideology
					has_variable = bpm_christian_democrats_wel_ideology
					has_variable = bpm_christian_democrats_cit_ideology
					has_variable = bpm_christian_democrats_mil_ideology
					has_variable = bpm_christian_democrats_fem_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_fem_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_dop_ideology
					has_variable = bpm_christian_democrats_eco_ideology
					has_variable = bpm_christian_democrats_wel_ideology
					has_variable = bpm_christian_democrats_cit_ideology
					has_variable = bpm_christian_democrats_mil_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_mil_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_dop_ideology
					has_variable = bpm_christian_democrats_eco_ideology
					has_variable = bpm_christian_democrats_wel_ideology
					has_variable = bpm_christian_democrats_cit_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_eco_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_dop_ideology
					has_variable = bpm_christian_democrats_wel_ideology
					has_variable = bpm_christian_democrats_cit_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_wel_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_dop_ideology
					has_variable = bpm_christian_democrats_cit_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_dop_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
					has_variable = bpm_christian_democrats_cit_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_cit_stance
				trigger = {
					has_variable = bpm_christian_democrats_sta_ideology
					has_variable = bpm_christian_democrats_rel_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_state_stance
				trigger = {
					has_variable = bpm_christian_democrats_rel_ideology
				}
			}
			triggered_desc = {
				desc = je_debating_the_religion_stance
				trigger = {
					NOT = { 
						has_variable = bpm_christian_democrats_rel_ideology
					}
				}
			}
		}
	}

	is_shown_when_inactive = {
		always = yes
		# OR = {
		# 	country_has_primary_culture = cu:north_german
		# 	country_has_primary_culture = cu:south_german
		# }
		# NOT = { this ?= c:UBD }
	}

	possible = {
		OR = {
			custom_tooltip = {
				text = "Catholic Interests already exist."
				ig:ig_christian_democrats = {
					NOT = {
						has_ideology = ideology:ideology_nonexistent
					}
				}
			}
			AND = {
				OR = {
					custom_tooltip = {
						text = "has_wealth_voting_or_higher"
						OR = {
							has_law = law_type:law_wealth_voting
							has_law = law_type:law_census_voting
							has_law = law_type:law_universal_suffrage
						}
					}
				}
				
				custom_tooltip = {
					text = "People's Springtime has fully ended."
          			has_global_variable = bpm_peoples_springtime_happened
				}
				
				OR = {
					custom_tooltip = {
						text = "tooltip_bpm_country_secularists_are_popular"
						bpm_secularist_popularity >= 0.2
					}
					custom_tooltip = {
						text = "tooltip_bpm_country_moralists_are_popular"
						bpm_moralist_popularity >= 0.25
						NOT = {
							country_has_state_religion = rel:catholic
						}
					}
					custom_tooltip = {
						text = "rerum_novarum_issued_tooltip"
						has_global_variable = global_rerum_novarum_issued_var
					}
				}

				custom_tooltip = {
					text = "Country is in Mainland Europe"
					bpm_country_is_in_mainland_europe = yes
					#NOT = {
					#	this ?= c:BRI
					#}
				}

				custom_tooltip = {
					text = "Country has more than or equal to 10% Catholics"
					religion_percent_country = { 
						target = rel:catholic
						value >= 0.1
					}
				}

				NOT = {
					has_journal_entry = je_cement_the_rightful_dynasty
				}
			}
		}
	}

	immediate = {
		set_variable = {
			name = independence_from_church_variable
			value = 0
		}
		set_variable = {
			name = christian_democrats_ideology_change
			value = 1
		}

		if = {
			limit = {
				owner = {
					ig:ig_christian_democrats ?= { has_ideology = ideology:ideology_nonexistent }
				}
				bpm_initialize_catholic_interests = yes
			}
		}

		scope:journal_entry = {
			set_variable = { 
				name = ideological_leaning_bar_variable
				value = "scripted_bar_progress(je_bpm_christian_democrat_ideology_progress_bar)" 
			}
			set_variable = { 
			name = economical_leaning_bar_variable
				value = "scripted_bar_progress(je_bpm_christian_democrats_economy_progress_bar)" 
			}
		}

		set_variable = { 
			name = ideological_leaning_bar_variable
			value = "scripted_bar_progress(je_bpm_christian_democrat_ideology_progress_bar)" 
		}

		set_variable = { 
			name = economical_leaning_bar_variable
			value = "scripted_bar_progress(je_bpm_christian_democrats_economy_progress_bar)" 
		}

		trigger_event = {
			id = bpm_christdem_split.1
			popup = yes
		}

		##### Thank u lilian for this great code
			# Shopkeeper population yandev
			set_variable = {
				name = bpm_shopkeeper_population_yandev_var
				value = 0
			}
			
			if = {
				limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.05 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.5 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.04 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.02 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.01 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.1 }
				}
			}

			# Farmer population yandev
			set_variable = {
				name = bpm_farmer_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.08 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.1 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.9 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.9 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.8 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.05 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.07 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.7 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.06 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.5 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.04 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.02 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.01 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.1 }
				}
			}

			# Clergymen population yandev
			set_variable = {
				name = bpm_clergymen_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.08 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.1 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.9 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.9 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.8 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.05 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.07 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.7 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.06 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.5 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.04 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.02 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.01 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.1 }
				}
			}

			# Aristocrat population yandev
			set_variable = {
				name = bpm_aristocrat_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.008 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.01 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.009 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.09 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.08 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.005 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.007 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.07 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.006 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.05 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.003 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.004 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.04 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.03 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.002 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.02 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.001 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.01 }
				}
			}
	}

	is_progressing = {
		OR = {
			NOT = {
				has_variable = cant_progress_sorry_var
			}
			NOT = {
				ROOT.var:cant_progress_sorry_var = 1
			}
		}
	}

	on_yearly_pulse = {
		events = {
			
		}
	}

	on_monthly_pulse = {
		effect = {
			scope:journal_entry = {
				set_variable = { 
					name = ideological_leaning_bar_variable
					value = "scripted_bar_progress(je_bpm_christian_democrat_ideology_progress_bar)" 
				}

				set_variable = { 
					name = economical_leaning_bar_variable
					value = "scripted_bar_progress(je_bpm_christian_democrats_economy_progress_bar)" 
				}
			}

			set_variable = { 
				name = ideological_leaning_bar_variable
				value = "scripted_bar_progress(je_bpm_christian_democrat_ideology_progress_bar)" 
			}

			set_variable = { 
				name = economical_leaning_bar_variable
				value = "scripted_bar_progress(je_bpm_christian_democrats_economy_progress_bar)" 
			}

			##### Thank u lilian for this great code
			# Shopkeeper population yandev
			set_variable = {
				name = bpm_shopkeeper_population_yandev_var
				value = 0
			}
			
			if = {
				limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.05 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.5 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.04 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.02 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = shopkeepers percent > 0.01 } }
					set_variable = { name = bpm_shopkeeper_population_yandev_var value = 0.1 }
				}
			}

			# Farmer population yandev
			set_variable = {
				name = bpm_farmer_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.08 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.1 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.9 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.9 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.8 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.05 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.07 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.7 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.06 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.5 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = farmers percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.04 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.02 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = farmers percent > 0.01 } }
					set_variable = { name = bpm_farmer_population_yandev_var value = 0.1 }
				}
			}

			# Clergymen population yandev
			set_variable = {
				name = bpm_clergymen_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.08 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.1 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.9 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.9 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.8 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.05 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.07 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.7 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.06 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.5 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.03 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.04 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.4 }
				}
				else = {
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.3 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.02 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.2 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.01 } }
					set_variable = { name = bpm_clergymen_population_yandev_var value = 0.1 }
				}
			}

			# Aristocrat population yandev
			set_variable = {
				name = bpm_aristocrat_population_yandev_var
				value = 0
			}
			if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.008 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.01 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.1 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.009 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.09 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.08 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.005 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.007 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.07 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.006 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.06 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.05 }
				}
			}
			else_if = {
				limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.003 } }
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.004 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.04 }
				}
				else = {
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.03 }
				}
			}
			else = {
				if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.002 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.02 }
				}
				else_if = {
					limit = { pop_type_percent_country = { pop_type = clergymen percent > 0.001 } }
					set_variable = { name = bpm_aristocrat_population_yandev_var value = 0.01 }
				}
			}


			if = {
				limit = {
					scope:journal_entry = {
						is_progressing = yes
					}
				}

				if = { ##### Ironically this causes laymen to organize better without the church. But we need base value for nerfing them.
					limit = {
						is_player = no
						country_has_state_religion = rel:catholic
					}
					change_variable = {
						name = independence_from_church_variable
						add = 0.066
					}
				}

				else_if = {
					limit = {
						is_player = yes
					}
					change_variable = {
						name = independence_from_church_variable
						subtract = 0.088
					}
				}

				if = { ##### Ironically the more intertwined the church and the state are the more the church wants to stop the laymen.
					limit = {
						country_has_state_religion = rel:catholic
					}
					if = {
						limit = {
							has_law = law_type:law_state_religion
						}
							
						change_variable = {
							name = independence_from_church_variable
							add = 0.05
						}
					}
					else_if = {
						limit = {
							OR = {
								has_law = law_type:law_freedom_of_conscience
								has_law = law_type:law_total_separation
							}
						}
							
						change_variable = {
							name = independence_from_church_variable
							add = 0.033
						}
					}
					else_if = {
						limit = {
							has_law = law_type:law_state_atheism
						}
							
						change_variable = {
							name = independence_from_church_variable
							add = 0.025
						}
					}
				}

				if = {
					limit = {
						country_has_state_religion = rel:catholic
					}
					if = {
						limit = {
							any_interest_group = {
								is_interest_group_type = ig_liberals
								ig_clout >= 0.033
							}
						}
						change_variable = {
							name = independence_from_church_variable
							add = {
								value = ROOT.ig:ig_liberals.ig_clout
								multiply = 1.19
							}
						}
					}

					if = {
						limit = {
							any_interest_group = {
								is_interest_group_type = ig_radicals
								ig_clout >= 0.025
							}
						}
						change_variable = {
							name = independence_from_church_variable
							add = {
								value = ROOT.ig:ig_radicals.ig_clout
								multiply = 1.3
							}
						}
					}

					if = { # They're practically off the leash, and are exploding in popularity.
						limit = {
							has_global_variable = global_rerum_novarum_issued_var
						}
						change_variable = {
							name = independence_from_church_variable
							add = {
								value = 0.25
							}
						}
					}

					if = { # 
						limit = {
							has_global_variable = global_variable_graves_de_communi_re
						}
						change_variable = {
							name = independence_from_church_variable
							subtract = {
								value = 0.15
							}
						}
					}
				}

				##### The movement stuff below doesn't work, requires fixing (how do the internationales work then?).
				##### Catholics are developing faster in catholic states rather than in protestants, requires fixing.
				##### Check out how the mechanic works with the newest 2.4 hotfixes.

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_liberal
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:bpm_liberal_movement.political_movement_support
								multiply = 0.25
							}
							else = {
								value = 0.02
							}
						}
					}
				}
				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_radical
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:bpm_radical_movement.political_movement_support
								multiply = 0.25
							}
							else = {
								value = 0.01
							}
						}
					}
				}

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_modernizer
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:bpm_modernizer_movement.political_movement_support
								multiply = 0.3
							}
							else = {
								value = 0.004
							}
						}
					}
				}

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_socialist
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:bpm_socialist_movement.political_movement_support
								multiply = 0.44
							}
							else = {
								value = 0.009
							}
						}
					}
				}

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_communist
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:movement_communist.political_movement_support
								multiply = 0.25
							}
							else = {
								value = 0.011
							}
						}
					}
				}

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_reformist_socialist
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:movement_reformist_socialist.political_movement_support
								multiply = 0.125
							}
							else = {
								value = 0.0097
							}
						}
					}
				}

				if = {
					limit = {
						any_political_movement = {
							is_political_movement_type = movement_anarchist
						}
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							if = {
								limit = {
									is_player = yes
								}
								value = ROOT.var:movement_anarchist.political_movement_support
								multiply = 0.25
							}
							else = {
								value = 0.005
							}
						}
					}
				}

				if = { ##### It all begun from here...
					limit = {
						has_technology_researched = labor_movement
					}
					change_variable = {
						name = independence_from_church_variable
						add = 0.0025
					}
				}

				if = { ##### Corporatism as a tool of interclass cooperation help to secure own cohesion and expand laymen influence.
					limit = {
						has_technology_researched = corporatism
					}
					change_variable = {
						name = independence_from_church_variable
						add = 0.0033
					}
				}

				if = { ##### Mass parties organised to combat hostile influence and defend your own.
					limit = {
						has_technology_researched = socialism
					}
					change_variable = {
						name = independence_from_church_variable
						add = 0.0044
					}
				}

				if = { ##### We shall speak aloud!
					limit = {
						has_technology_researched = political_agitation
					}
					change_variable = {
						name = independence_from_church_variable
						add = 0.005
					}
				}

				if = { ##### Population loves liberalism, why don't the catholics grow into the liberal democracy?
					limit = {
						has_variable = bpm_consciousness_liberal
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							value = var:bpm_consciousness_liberal
							multiply = 0.0043
						}
					}
				}

				if = { ##### The church's strength translates to slower laymen independence
					limit = {
						country_has_state_religion = rel:catholic
					}
					change_variable = {
						name = independence_from_church_variable
						subtract = {
							value = ig:ig_devout.ig_clout
							multiply = 5
						}
					}
				}
				if = { ##### Christian Democrats/Catholic Interests are rising, they got to break away from the church.
					limit = {
						country_has_state_religion = rel:catholic
					}
					change_variable = {
						name = independence_from_church_variable
						add = ig:ig_christian_democrats.ig_clout
					}
				}

				if = { ##### Strong moralist can effectively combat any brave laymen.
					limit = {
						country_has_state_religion = rel:catholic
					}
					if = { ### Conservatives hate the gallant laymen!
						limit = {
							any_interest_group = {
								has_ideology = ideology:ideology_rel_moralist
								is_interest_group_type = ig_conservatives
							}
						}
						change_variable = {
							name = independence_from_church_variable
							subtract = {
								value = ROOT.ig:ig_conservatives.ig_clout
								multiply = 1.66
							}
						}
					}
					if = { ### Reactionaries even more!
						limit = {
							any_interest_group = {
								is_interest_group_type = ig_reactionaries
								has_ideology = ideology:ideology_rel_radical_moralist
							}
						}
						change_variable = {
							name = independence_from_church_variable
							subtract = {
								value = ROOT.ig:ig_reactionaries.ig_clout
								multiply = 2
							}
						}
					}

					if = { ### National Liberals dislike laborers
						limit = {
							any_interest_group = {
								has_ideology = ideology:ideology_rel_moralist
								is_interest_group_type = ig_national_liberals
							}
						}
						change_variable = {
							name = independence_from_church_variable
							subtract = {
								value = ROOT.ig:ig_national_liberals.ig_clout
								multiply = 1.33
							}
						}
					}
				}

				if = {
					limit = {
						exists = ig:ig_trade_unions
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							value = ROOT.ig:ig_trade_unions.ig_clout
							multiply = 0.5
						}
					}
				}

				if = {
					limit = {
						exists = ig:ig_christian_democrats
					}
					change_variable = {
						name = independence_from_church_variable
						add = {
							value = var:christian_democrats_ideology_change
							multiply = ROOT.ig:ig_christian_democrats.ig_clout
							divide = 2.50
						}
					}
				}

				if = {
					limit = {
						has_variable = cant_progress_sorry_var
					}
					remove_variable = cant_progress_sorry_var
					change_variable = {
						name = cant_progress_sorry_var
						value = 0
					}
				}
				
				if = {
					limit = { 
						NOT = {
							has_global_variable = global_variable_quanta_cura_var_released
						}
						ROOT.var:independence_from_church_variable >= 50
					}
					set_variable = {
						name = independence_from_church_variable
						value = 50
					}
					#set_variable = {
					#	name = cant_progress_sorry_var
					#	value = 1
					#}
				}

				else_if = {
					limit = { 
						NOT = {
							has_global_variable = global_rerum_novarum_issued_var
						}
						ROOT.var:independence_from_church_variable >= 100
					}
					set_variable = {
						name = independence_from_church_variable
						value = 100
					}
					#set_variable = {
					#	name = cant_progress_sorry_var
					#	value = 1
					#}
				}

				else_if = {
					limit = { 
						NOT = {
							has_global_variable = global_variable_graves_de_communi_re
						}
						ROOT.var:independence_from_church_variable >= 150
					}
					set_variable = {
						name = independence_from_church_variable
						value = 150
					}
					#set_variable = {
					#	name = cant_progress_sorry_var
					#	value = 1
					#}
				}

				clamp_variable = {
					name = independence_from_church_variable
					max = 200
					min = 0
				}
			}
		}
		
		events = {
			bpm_christdem_split.3 # Lay Movements and the Church
			bpm_christdem_split.4 # Decentralization
			bpm_christdem_split.8 # Citizenship/Nationalism
			bpm_christdem_split.9 # Democracy

			######## Post-Rerum Novarum:

			bpm_christdem_split.7 # Welfare
			bpm_christdem_split.5 # Economy
			bpm_christdem_split.10 # Military
			bpm_christdem_split.11 # Women's Rights
			bpm_christdem_split.12 # The IG becomes even more independent and is able to create official programmes/proper organizations/party whatever

			####### Revalitisation of Older Ideas

			bpm_christdem_split.50 # Economy: Return
			bpm_christdem_split.51 # Politics: Return
		}
	}

	on_yearly_pulse = {
		random_events = {
		 	60 = 0
		 	5 = bpm_christdem_flavour.1
			5 = bpm_christdem_flavour.3 
		}
	}

	complete = {
		custom_tooltip = {
			text = "bpm_je_progress_complete"
			var:independence_from_church_variable >= 200
			#always = no
		}
	}

	on_complete = {
		trigger_event = {
			id = bpm_christdem_split.13
		}
		custom_tooltip = ig_christian_democrats_distinct_tt
		custom_tooltip = ig_christian_democrats_no_more_ideologies_tt
	}

	progressbar = yes

	current_value = {
		value = var:independence_from_church_variable 
	}

	goal_add_value = {
		add = 200
		max = 200
	}

	weight = 10000
	should_be_pinned_by_default = yes
}


je_bpm_new_wine_in_old_wineskins = {
	icon = "gfx/interface/icons/goods_icons/wine.dds"

	group = bpm_je_group_interest_groups
	
	modifiers_while_active = {
		bpm_new_wine_in_old_wineskins_modifier
	}

	scripted_progress_bar = bpm_new_wine_scripted_progress_bar
	scripted_progress_bar = bpm_old_wine_paternalism_progress_bar

	scripted_button = je_bpm_propagate_the_new_wine_button
	scripted_button = je_bpm_reaffirm_the_old_tastes

	is_shown_when_inactive = {
		always = yes
	}

	immediate = {
		####################################
		####### Christian Democrats must exist. Setting their names up in the conflict.
		if = {
			limit = {
				exists = ig:ig_christian_democrats
			}
			if = { # Innovators vs. Agrarian Conservatives debate
				limit = {
					this ?= c:LUX
				}
				ig:ig_christian_democrats ?= { set_interest_group_name = ig_innovateuren }
				ig:ig_conservatives ?= { set_interest_group_name = ig_agrarian_conservatives }
			}
			else_if = { # Young Right vs. Old Right debate
				limit = {
					OR = {
						this ?= c:BEL
						country_has_primary_culture = cu:flemish
					}
				}
				ig:ig_christian_democrats ?= { set_interest_group_name = ig_young_right }
				ig:ig_conservatives ?= { set_interest_group_name = ig_old_right }
			}
			else = { # Christian Democrats join in on the 'conservatives' term, though not ones really, so we need to make Burkeans visibly distinct
				ig:ig_conservatives ?= { set_interest_group_name = ig_classical_conservatives }
			}
		}

		set_local_variable = bpm_old_new_wine_var

		set_variable = {
			name = clacons_traits_var
			value = bpm_je_clacon_ideological_power
		}
		set_variable = {
			name = christdem_traits_var
			value = bpm_je_christdem_ideological_power
		}
		set_variable = {
			name = wine_events_and_other_variable
			value = 0
		}

		if = {
			limit = {
				ig:ig_conservatives ?= {
					is_in_government = yes
				}
			}
			je:je_bpm_new_wine_in_old_wineskins = {
				add_progress = { 
					value = -2
					name = bpm_new_wine_scripted_progress_bar 
				}
			}
		}
		trigger_event = {
			id = bpm_new_wine_old_wineskins_flavour.11
			popup = yes
		}
	}

	possible = {
		custom_tooltip = {
			text = "rerum_novarum_issued_tooltip"
			has_global_variable = global_rerum_novarum_issued_var
		}
		custom_tooltip = {
			text = "christdems_dont_have_divine_and_are_rather_progressive_welfare"
			ig:ig_christian_democrats = {
				NOT = {
					has_ideology = ideology:ideology_dop_divine_democrat
				}
				OR = {
					has_ideology = ideology:ideology_wel_expanded_public_welfare
					has_ideology = ideology:ideology_wel_social_market_welfare
				}
			}
		}
		custom_tooltip = {
			text = "christdems_cons_in_the_same_party"
			OR = {
				AND = {
					ig:ig_christian_democrats = {
						has_party = yes
						party = {
							is_party_type = conservative_party
						}
					}
					ig:ig_conservatives = {
						has_party = yes
						party = {
							is_party_type = conservative_party
						}
					}
				}
				AND = {
					ig:ig_christian_democrats = {
						has_party = yes
						party = {
							is_party_type = religious_party
						}
					}
					ig:ig_conservatives = {
						has_party = yes
						party = {
							is_party_type = religious_party
						}
					}
				}
			}
		}
		
		#always = yes # needs fixing, so it doesn't show up in the journal entry list
	}

	invalid = {
		
	}

	timeout = 3650 # 5475

	on_timeout = {
		if = {
			limit = {	
				always = yes
				exists = ig:ig_christian_democrats
			}

			custom_tooltip = bpm_status_quo_tooltip_tt

			trigger_event = { 
				id = bpm_new_wine_old_wineskins_flavour.3 
				#days = 1 
			}
		}
	}

	complete = {
		custom_tooltip = {
			text = "new_wine_value_50_tooltip"
			je:je_bpm_new_wine_in_old_wineskins ?= { 
				"scripted_bar_progress(bpm_new_wine_scripted_progress_bar)" >= 75
			}
		}
	}

	on_complete = {
		if = {
			limit = {	
				always = yes
				exists = ig:ig_christian_democrats
			}
			
			trigger_event = { 
				id = bpm_new_wine_old_wineskins_flavour.1
			}

			set_local_variable = bpm_old_new_wine_christian_democrat_win_variable

			custom_tooltip = bpm_christian_democratic_ideas_more_widespread_tt
			
			ig:ig_conservatives = {
				add_modifier = {
					name = bpm_ig_defeated_in_struggle_for_survival_ig
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
	}

	on_weekly_pulse = { 
		effect = {
			scope:journal_entry = {
				set_variable = { 
					name = christdem_ideological_power_variable
					value = "scripted_bar_progress(bpm_new_wine_scripted_progress_bar)" 
				}

				set_variable = { 
					name = clacon_ideological_power_variable
					value = "scripted_bar_progress(bpm_old_wineskins_scripted_progress_bar)" 
				}
			}
		}
		events = {
			bpm_new_wine_old_wineskins_flavour.100 # Expanding/Limiting Franchise (in disfavour of workers)
			bpm_new_wine_old_wineskins_flavour.101 # Introduced Limited Regulations
			#bpm_new_wine_old_wineskins_flavour.102 # Agriculture bill
			#bpm_new_wine_old_wineskins_flavour.103 # Empowering the Church greatly
			#bpm_new_wine_old_wineskins_flavour.104 # Improving life overall
			bpm_new_wine_old_wineskins_flavour.105 # Wage subsidies passed
			bpm_new_wine_old_wineskins_flavour.106 # Sunday Rest Act
		}
	}

	on_monthly_pulse = {
		random_events = {
		 	65 = 0
		 	5 = bpm_new_wine_old_wineskins_flavour.4
			5 = bpm_new_wine_old_wineskins_flavour.5
			5 = bpm_new_wine_old_wineskins_flavour.6
			5 = bpm_new_wine_old_wineskins_flavour.7
			5 = bpm_new_wine_old_wineskins_flavour.8
			5 = bpm_new_wine_old_wineskins_flavour.9
			5 = bpm_new_wine_old_wineskins_flavour.10
		}

		effect = {
			############################
			####### Scopes
			ig:ig_christian_democrats = {
				leader = {
					save_scope_as = christdem_leader_scope
				}
			}

			ig:ig_conservatives = {
				leader = {
					save_scope_as = clacons_leader_scope
				}
			}

			############################
			####### Variables: Set up variables for certain traits etc. and then math them up. So we can also show how much each trait or thingy adds or takes
			### Traits: +Dirtect, +Persistent, -Reckless, +Meticulous, ++Charismatic, ++Pious, +Imposing, ++Master Bureaucrat, +Any Political Operator.
			### Popularity:
			### IG Clout
			### Events and other reasons:
			
			##### TRAITS
			# Direct

			set_variable = {
				name = clacons_traits_var
				value = bpm_je_clacon_ideological_power
			}
			set_variable = {
				name = christdem_traits_var
				value = bpm_je_christdem_ideological_power
			}
		}
	}

	fail = {
		OR = {
			custom_tooltip = {
				text = "old_wineskins_paternalism_progress_tooltip"
				var:bpm_old_wine_paternalism_progress_bar_var >= 6
			}
			custom_tooltip = {
				text = "new_wine_value_minus_25_tooltip"
				je:je_bpm_new_wine_in_old_wineskins ?= { 
					"scripted_bar_progress(bpm_new_wine_scripted_progress_bar)" <= -25
				}
			}
		}
	}

	on_fail = {
		if = {
			limit = {	
				always = yes
				exists = ig:ig_christian_democrats
			}

			#custom_tooltip = bpm_conservatives_winning_tooltip_tt

			set_local_variable = bpm_old_new_wine_conservative_win_variable
			
			trigger_event = { 
				id = bpm_new_wine_old_wineskins_flavour.2 
				#days = 1 
			}

			custom_tooltip = bpm_christian_democratic_ideas_more_suppressed_tt
			
			ig:ig_christian_democrats = {
				add_modifier = {
					name = bpm_ig_defeated_in_struggle_for_survival_ig
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
	}

	should_be_pinned_by_default = yes
}